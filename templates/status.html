<!-- templates/status.html — VERSIÓN FINAL DEFINITIVA (FUNCIONA 100%) -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ML Autonomous Agent - En ejecución</title>
  <meta http-equiv="refresh" content="60">
  <style>
    body {
      background: #000;
      color: #0f0;
      font-family: 'Courier New', monospace;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      text-align: center;
    }
    h1 { font-size: 2.8em; text-shadow: 0 0 20px #0f0; margin-bottom: 10px; }
    h2 { font-size: 1.8em; margin: 20px 0; }
    .job-id { font-size: 1.3em; color: #0cc; margin-bottom: 30px; }

    /* BARRA DE PROGRESO */
    .progress-container {
      background: #111; border: 3px solid #0f0; border-radius: 15px;
      padding: 20px; margin: 40px 0; box-shadow: 0 0 30px #0f05;
    }
    .progress-bar {
      height: 40px; background: linear-gradient(90deg, #0f0, #0f8);
      width: {{ progress }}%; border-radius: 10px; transition: width 0.9s ease;
      box-shadow: 0 0 20px #0f0;
    }
    .progress-text { font-size: 1.6em; margin-top: 15px; text-shadow: 0 0 15px #0f0; }

    /* TERMINAL */
    .terminal {
      background: #000; border: 2px solid #0f0; border-radius: 10px;
      padding: 20px; margin: 30px 0; text-align: left; max-height: 600px;
      overflow-y: auto; box-shadow: 0 0 40px #0f08; font-size: 1.1em;
    }
    .log-line { display: block; animation: appear 0.4s ease-out; margin: 2px 0; }
    @keyframes appear { from { opacity: 0; transform: translateX(-30px); } to { opacity: 1; transform: translateX(0); } }

    /* BOTONES */
    .buttons { margin: 40px 0; }
    .buttons a {
      display: inline-block; background: #0f0; color: #000;
      padding: 14px 28px; margin: 10px; border-radius: 8px;
      text-decoration: none; font-weight: bold; font-size: 1.2em;
      box-shadow: 0 0 20px #0f0; transition: all 0.3s;
    }
    .buttons a:hover { background: #0ff; transform: scale(1.05); box-shadow: 0 0 30px #0ff; }
    .success { color: #0f0; text-shadow: 0 0 20px #0f0; }
    .error { color: #f33; background: #300; padding: 15px; border-radius: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ML AUTONOMOUS AGENT</h1>
    <div class="job-id">Job ID: {{ job_id }}</div>
    <h2>Estado: {{ job.status.capitalize() }}</h2>

    <!-- BARRA DE PROGRESO -->
    <div class="progress-container">
      <div class="progress-bar" style="width: {{ progress }}%"></div>
      <div class="progress-text">{{ progress }}% → {{ current_step }}</div>
    </div>

    <!-- LOGS LIMPIOS -->
    <div class="terminal">
      <pre>
{% if job.detailed_log %}
  {% for line in job.detailed_log %}
        <span class="log-line">{{ line }}</span>
  {% endfor %}
{% else %}
  {% for msg in job.messages %}
        <span class="log-line">{{ msg }}</span>
  {% endfor %}
{% endif %}
      </pre>
    </div>

    <!-- BOTONES 100% FUNCIONALES (CORREGIDOS) -->
    {% if job.status == "completed" %}
      <h2 class="success">¡PIPELINE COMPLETADO CON ÉXITO!</h2>
      <div class="buttons">
        <a href="/reports/EDA_report_{{ job_id }}.html" target="_blank">
          Ver EDA Interactivo
        </a>
        <a href="/graphics/shap_{{ job_id }}.png" target="_blank">
          Ver Gráfico SHAP
        </a>
        <a href="/download/pdf/{{ job_id }}" target="_blank">
          Descargar Informe PDF
        </a>
        <a href="/" target="_self">
          Volver a la página principal
        </a>
      </div>
    {% endif %}

    {% if job.status == "failed" %}
      <div class="error">
        <strong>ERROR EN EL PIPELINE</strong><br>
        Revisa el log superior. Posibles causas:<br>
        • Nombre de columna mal escrito<br>
        • Archivo CSV dañado o vacío<br>
        • Formato no compatible
      </div>
    {% endif %}
  </div>
</body>
</html>